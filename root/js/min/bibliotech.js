$(document).ready(function(){"use strict";$.event.props.push("dataTransfer");var a=io(),b="images/",c={},d=[],e=Math.round($(window).width()/256),f=function(){return c={},a.close(),window.location.assign("/logout")},g=function(){return c.picture&&c.link?void $(".picture").html($("<img>").prop("id","plusLink").attr("src",c.picture).css({width:32,height:32,cursor:"pointer"})).attr("alt","Google+").click(function(){window.open(c.link)}).removeClass("notdisplayed"):!1},h=function(){alert($(this).data("book").title)},i=function(){$(window).height()+$(window).scrollTop()>$(this).offset().top&&$(this).data("src")&&($(this).removeAttr("torotate").attr("src",$(this).data("src")).data("src",""),$(this).closest(".bookcell").css("visibility","visible").animateRotate("X",-90,0,250))},j=function(){var a=$("#dock").length?$("#dock"):$("<div>").prop("id","dock").appendTo($("body"));if($(".col",a).length!==e){$(".col",a).remove();for(var b=[],c=0;e>c;c++)b.push($("<div>").addClass("col").attr("colid",c).css({width:Math.round(99/e)+"%","max-width":Math.round(99/e)+"%"}));a.css("padding-top",$("#navbar").is(":visible")?$("#navbar").height():0).append(b),$(".col").on({dragenter:function(a){a.preventDefault()},dragover:function(a){a.preventDefault()},drop:function(a){a.preventDefault();var b=a.dataTransfer.getData("cellId"),c=a.target;return $(c).closest(".bookcell").length?$("#"+b).insertBefore($(c).closest(".bookcell")):$("#"+b).appendTo($(this)),!1}})}return a},k=function(a){var c="collection"===$(this).attr("id");c&&(a=d);var f,g=j();for(var k in a){var l=$("#tempCell").clone().attr("id",a[k].id).data("book",a[k]).addClass("bookcell").appendTo($("[colid="+$(".bookcell").length%e+"]")).css("visibility","hidden"),m=new Image;$(".title",l).html(a[k].title),$(".authors",l).html(a[k].authors?a[k].authors.join(", "):""),$(".cover",l).append($(m)),$(m).data("src",a[k].alternative||a[k].cover).attr("torotate",!0),$(".infos",l).attr("description",a[k].description||""),c?$(".ajouter",l).hide():$(".supprimer",l).hide(),m.src=b+"iconmonstr-book-4-icon-white.png"}$("img",g).on("load",i),$(".cover").not(".bouton").click(h),$(".bookcell").on({dragstart:function(a){f=$(this),f.addClass("isDrag"),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",a.dataTransfer.setData("cellId",f.prop("id"))},dragend:function(a){f.removeClass("isDrag")}})},l=function(){return $(this).hasClass("active")?!1:void $("img",this).attr("src",b+$("img",this).attr("hover"))},m=function(){return $(this).hasClass("active")?!1:void $("img",this).attr("src",b+$("img",this).attr("blur"))},n=function(){$(".active").removeClass("active").each(m),$(this).addClass("active"),$("img",this).attr("src",b+$("img",this).attr("active"))};$.fn.animateRotate=function(a,b,c,d){var e=$(this),f=$.Deferred();return $(this).show(),$({deg:b}).animate({deg:c},{duration:d,step:function(b){e.css({transform:"rotate"+a+"("+b+"deg)"})},complete:function(){f.resolve()}}),f.promise()},a.on("user",function(a){c=a,g(),$("#navbar > div").not(".picture").hover(l,m),$("[blur]").closest("div").each(m),$("#recherche, #collection").click(n),$("img").attr("draggable",!1),$("#waitingAnim").addClass("notdisplayed"),$("#navbar").removeClass("notdisplayed"),$("#collection").click(k),j()}),a.on("collection",function(b){b.books&&(d=b.books),$("#collection").click(),$("#waiting").slideUp("slow"),a.emit("searchBooks",{q:"gemmell"})}),a.on("books",function(a){k(a)}),a.on("logout",f),$(document).scroll(function(){$("[torotate]").each(i)}),$("#logout").click(f)});
