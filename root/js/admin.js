var start=new Date,µ=document,app=angular.module("admin",["preloader","socket","defcloak"]);app.config(["$interpolateProvider","$sceProvider",function(a,b,c){a.startSymbol("[{"),a.endSymbol("}]"),b.enabled(!1)}]),app.run(["$rootScope","$http","$window","$timeout","$socket","$preloader",function(a,b,c,d,e,f){"use strict";a.logout=function(){return location.assign("/logout"),e.close(),!1},a.orders={},a.show={},e.on("users",function(b){a.ref_user=b,a.users=angular.copy(b)}),e.on("sessions",function(b){a.ref_session=b,a.sessions=angular.copy(b)}),e.on("books",function(b,c){a.ref_book=b,a.ref_perso=c,a.books=angular.copy(b),a.persos=angular.copy(c)}),e.on("covers",function(b){a.covers=b,_.forEach(b,function(a){f.preloadImages(a.cover).then(function(){a.source={"background-image":"url("+a.cover+")"}})})}),e.on("comments",function(b){a.ref_comment=b,a.comments=angular.copy(b)}),e.on("notifications",function(b){a.ref_notification=angular.copy(b),a.notifications=b}),e.on("logs",function(b){a.logs=b}),angular.element(µ.alls("h2 .titre")).bind("click",function(){a.$apply(a.show[this.parentNode.parentNode.getAttribute("type")]=!a.show[this.parentNode.parentNode.getAttribute("type")])}),angular.element(µ.one("#logout")).bind("click",function(){a.logout()}),angular.element(µ.one("#footer")).bind("click",function(){var a=setInterval(function(){var b=((c.scrollY||µ.documentElement.scrollTop)/2-.1).toFixed(1);c.scroll(0,b),.1>=b&&(c.scroll(0,0),clearInterval(a))},100)}),angular.element(µ.alls("[field]")).bind("click",function(){var b=this.parentNode.parentNode.getAttribute("type"),c=this.getAttribute("field");a.orders[c]=!a.orders[c],a[b]=_.sortBy(a[b],c),a.orders[c]&&a[b].reverse(),a.$apply()}),angular.element(c).bind("scroll",function(){a.$apply(a.footer=c.scrollY||µ.documentElement.scrollTop)})}]),app.directive("submit",["$socket",function(a){"use strict";return{restrict:"A",link:{post:function(b,c,d){var e=_.find(_.keys(b),function(a){return!_.startsWith(a,"$")}),f=b[e],g=_.find(b.$parent["ref_"+e],_.matchesProperty("_id",b[e]._id));c.on("click",function(){a.emit("update",{collection:e+"s",values:f}),delete f.newPassword,g=angular.copy(f),b.$apply(b.disable=!0)}),b.$watch(function(){return b[e]},function(){b.disable=angular.equals(f,g)},!0)}}}}]),app.directive("delete",["$socket",function(a){"use strict";return{restrict:"A",link:function(b,c,d){var e=_.find(_.keys(b),function(a){return!_.startsWith(a,"$")});c.on("click",function(){a.emit("delete",{collection:e+"s",_id:b[e]._id}),b.$apply(_.remove(b.$parent[e+"s"],b[e]))})}}}]);
