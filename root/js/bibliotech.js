window.FileReader&&"formNoValidate"in document.createElement("input")?$(document).ready(function(){"use strict";console.debug("document.ready",(new Date).toLocaleString()),$.event.props.push("dataTransfer");var a=io({reconnection:!0}),b=new ColorThief,c={initialize:function(a){if(!a.id)return l();for(var b in a)this[b]=a[b];this.picture&&this.link&&($(".picture").html($("<img>").attr("src",this.picture).css({width:32,height:32,cursor:"pointer"})).attr("alt","Google+").on("click",function(){window.open(c.link)}),$(".gSignIn").toggleClass("notdisplayed")),this.first||$("#profileWindow").trigger("click"),console.debug("User.initialize",(new Date).toLocaleString())},initProfileValues:function(){$("#formProfil [name=mail]").val(c.id),$("#formProfil [name=name]").val(c.name),c.googleSignIn?($("[name=googleSignIn]").prop("checked",!0),c.googleSync&&$("#formProfil [name=googleSync]").prop("checked",!0)):$("#formProfil [name=pwd]").attr("required",!0)},"delete":function(){return $("#errPwd").hide(),document.getElementsByName("pwd")[0].checkValidity()?(n.confirm("warning",$("#delete").attr("confirm")).then(function(){a.emit("deleteUser",$("[name=pwd]").val())}),!1):$("#errPwd").show()},update:function(){return event.preventDefault(),$("#errPwd").fadeOut(),a.emit("updateUser",$(this).formToJSON()),!1},retUpdate:function(a){c.name=a.name,c.googleSync=a.googleSync,n.close()},book:function(a){return _.find(this.books,{id:a})},bookIndex:function(a){return _.findIndex(this.books,{id:a})},addBook:function(a){-1===c.bookIndex(a.id)&&(c.books.push(a),c.books=_.sortBy(c.books,"title")),g.one(a.id).book=a,$("#nbBooks").html(c.books.length)},removeBook:function(a){return _.remove(this.books,{id:a}),this.books.length},updateBook:function(a){var b=this.bookIndex(a.id);-1!==b&&(this.books[b]=$.extend(this.books[b],a))},updateTags:function(){this.tags=_.countBy(_.flatten(_.compact(_.pluck(this.books,"tags")),!0).sort()),$("span",$("#cloud")).remove()},destroy:function(){for(var a in this)_.isFunction(this[a])||delete this[a]},collection:function(){$("[name=filtre]").val(""),$("[name=filtre]").data("prec",""),$("#tags").toggle(!$.isEmptyObject(c.tags)),$(".bookcell").removeClass("tofilter tohide"),$("#nbBooks").html(c.books.length),$("#collection").hasClass("active")?(g.reorganize(),k.end(c.books.length)):(e.active.call("#collection"),g.show(c.books,!0))}},d={nbCols:~~($(window).innerWidth()/256),get:function(){var a=$("#dock").length?$("#dock"):$("<section>").prop("id","dock").attr("role","main").appendTo($("body")).append($("<section>").addClass("notdisplayed")),b=a.width()/d.nbCols;if($(".col",a).length!==d.nbCols){$(".col",a).remove();for(var c=[],e=0;e<d.nbCols;e++)c.push($("<div>").addClass("col").attr("colid",e).css({width:b,"max-width":b}));a.css("padding-top",$("#navbar").is(":visible")?$("#navbar").height():0).append(c),$(".col").on({dragenter:function(){event.preventDefault()},dragover:function(){event.preventDefault()},drop:function(a){return a.preventDefault(),$(a.target).closest(".bookcell").length?(g.one(a.dataTransfer.getData("cell")).cell.insertBefore($(a.target).closest(".bookcell")),g.loadCovers()):g.one(a.dataTransfer.getData("cell")).cell.appendTo($(this)),!1}})}return a},remove:function(){$("#dock").remove()}},e={path:"images/",hover:function(){var a=$(this).is("img")?$(this):$("img",this);return $(this).hasClass("active")||$(this).hasClass("sortBy")?!1:void a.attr("src",e.path+a.attr("hover"))},blur:function(){var a=$(this).is("img")?$(this):$("img",this);return $(this).hasClass("active")||$(this).hasClass("sortBy")?!1:void a.attr("src",e.path+a.attr("blur"))},active:function(){$(".active").removeClass("active").each(e.blur),$(this).addClass("active"),$("#tags").toggle("collection"===$(this).prop("id")&&!$.isEmptyObject(c.tags)),$("img",this).attr("src",e.path+$("img",this).attr("active"))}},f={show:function(){e.hover.call($("#sort img").first()),$("#tags, #notifs").hide()},toggle:function(){$(".navbar").fadeToggle(function(){$("#dock").animate({"padding-top":$("#navbar").is(":visible")?$("#navbar").height():0},100)})},toggleNotif:function(a){a&&$("#sort").fadeOut(),$("#notifs").css({top:$("#navbar").height()+5,left:$("#notifications").offset().left}),$("#notifs").fadeToggle()},toggleSort:function(a){a&&$("#notifs").fadeOut(),$("#sort").css({top:$("#navbar").height()+5,left:$("#tris").offset().left}),$("#sort").fadeToggle()},link:function(){window.open($(this).attr("url"))},mail:function(){document.location.href="mailto:"+$(this).attr("mail")}},g={cells:[],add:function(a){g.cells=_.union(g.cells,_.isArray(a)?a:[a])},destroy:function(){d.remove(),g.cells=[]},one:function(a){return _.find(g.cells,{id:a})},show:function(a,b){b&&g.destroy();var d=[];for(var e in a)g.one(a[e].id)||d.push(new h(c.book(a[e].id)||a[e]));g.add(d),g.reorganize(d,!0),p.toggle()},returned:function(a){g.one(a.id).returned(a)},reorganize:function(a,b){a=a||_.sortBy(g.cells,function(a){return[a.row,a.col]});for(var c=d.get(),e=b?$(".bookcell","[colid]").length:0,f=0,h=0,i=a.length;i>h;h++){var j=$(a[h].cell);a[h].col=(e+h)%d.nbCols,a[h].row=Math.floor((e+h)/d.nbCols),j.hasClass("tohide")||j.hasClass("tofilter")?j.appendTo($(".notdisplayed",c)):(j.appendTo($("[colid="+f%d.nbCols+"]",c)).css("visibility","hidden"),$(j).addClass("torotate"),f++)}g.loadCovers()},loadCovers:function(){for(var a in g.cells)g.cells[a].loadCover();$("#footer").toggle(!!$(window).scrollTop())},byTags:function(a){$("#formFilter").trigger("reset"),$(".bookcell").removeClass("tofilter");for(var b in g.cells)g.cells[b].cell.toggleClass("tohide",-1===$.inArray(a,g.cells[b].book.tags));g.reorganize()},sort:function(){$(".sortBy").removeClass("sortBy"),e.blur.call(".sortBy"),$(this).addClass("sortBy"),e.hover.call(".sortBy");var a=$(this).attr("by"),b=$(this).attr("sort"),c=_.sortBy(g.cells,function(b){return b.book[a]||null});b&&c.reverse(),g.reorganize(c)},filter:function(){var a=this.value.toLowerCase();if(this.checkValidity()&&a!==$(this).data("prec")){$(this).data("prec",a);for(var b in g.cells){var c=g.cells[b].book.title.toLowerCase(),d=g.cells[b].book.authors?g.cells[b].book.authors.join(", ").toLowerCase():"",e=g.cells[b].book.description.toLowerCase();g.cells[b].cell.toggleClass("tofilter",-1===c.indexOf(a)&&-1===d.indexOf(a)&&-1===e.indexOf(a))}g.reorganize()}}},h=function(b){var d=this,e=$("#tempCell").clone().removeAttr("id").addClass("bookcell").css("visibility","hidden"),f=function(){var d=$(this).prop("class");$("button",e).fadeToggle(),"add"===d&&a.emit("addBook",b.id),"remove"===d&&($("#collection").hasClass("active")&&e.fadeToggle(function(){$(this).remove(),g.loadCovers()}),a.emit("removeBook",b.id),$("#nbBooks").html(c.removeBook(b.id)))},h=function(a){d.book=a,d.opened=!0,o.data=d,o.show()},i=function(a){if($(a.relatedTarget).hasClass("description")||$(".description").remove(),"mouseenter"===a.type&&b.description){var c=b.description.indexOf(" ",500),d=function(){$(this).remove()},e={"max-height":$(window).height(),left:Math.min($(this).position().left+$(this).innerWidth()/3,$(window).innerWidth()-1.333*$(this).innerWidth())},f=$(this).position().top+$(this).innerHeight()/3,g=$("<div>").hide().width($(this).width()).appendTo($("body")).addClass("description").html(b.description.substr(0,Math.max(c,500))+(-1!==c?"...":"")).prepend($("<span>").html(b.title+"<BR>")).on("click",d).attr("bookid",b.id);f+g.outerHeight()>$(document).innerHeight()?e.bottom=.333*$(this).innerHeight():e.top=f,g.css(e),setTimeout(function(){g.fadeIn().mouseleave(d)},1e3)}},j=function(){p.toggle(1,1),-1!==c.bookIndex(b.id)||d.opened?(o.data=d,o.show(-1!==c.bookIndex(b.id))):a.emit("searchDetail",b.id)},k=function(){if(e.hasClass("torotate")){var a=$("img:first",e);a.length&&$(window).height()+$(window).scrollTop()>e.offset().top&&(e.removeClass("torotate"),(b.alternative||b.base64||b.cover)&&a.attr("src",b.alternative||b.base64||b.cover),e.css("visibility","visible").fadeIn(),e.on({dragstart:l,dragend:m}),$({deg:-90}).animate({deg:0},{duration:250,step:function(a){e.css({transform:"rotateX("+a+"deg)"})},complete:function(){$("img:last-of-type",e).css("bottom",$("figcaption",e).height()+5)}}))}},l=function(a){$(this).addClass("isDrag"),a.dataTransfer.effectAllowed="move",a.dataTransfer.dropEffect="move",a.dataTransfer.setData("cell",d.id)},m=function(){$(this).removeClass("isDrag")};return this.id=_.isObject(b.id)?JSON.stringify(b.id):b.id,this.book=b,this.cell=e,this.loadCover=k,this.opened=!1,this.returned=h,$("header",e).html(b.title),$("button",e).on("click",f),$("img, .title, .authors",e).not(".bouton").on("click",j),$("figcaption",e).html(b.authors?b.authors.join(", "):""),$("img:last-of-type",e).toggle(!!b.access&&"NONE"!==b.access),-1!==c.bookIndex(b.id)?$(".add",e).hide():$(".remove",e).hide(),i&&e.hover(i),this},i={show:function(){var a=function(){i.show(),g.byTags($(this).html())},b=function(){if(c.tags&&!$("span",$(this)).length){var b=[];for(var d in c.tags)b.push({text:d,weight:c.tags[d],html:{"class":"tag",weight:c.tags[d]},handlers:{click:a}});$("#cloud").jQCloud(b)}};$("html").toggleClass("overflown",!$("#cloud").is(":visible")),$("#cloud").fadeToggle(b)},add:function(){event.preventDefault();var a=$(this).formToJSON().tag.toLowerCase(),b=$("#userTags > div").toArray(),c=_.find(b,function(b){return $(".libelle",b).html()===a});c||(b.push(i["new"](a,!0)),$("#userTags").append(_.sortBy(b,function(a){return $(".libelle",a).html()}))),this.reset()},"new":function(a,b){var c=$("#tempTag").clone().removeAttr("id").on("click",function(){$(event.target).hasClass("libelle")?(n.close(),g.byTags($(event.target).html())):$(this).fadeOut().promise().then(function(){$(this).remove(),$("[autofocus]","#detailWindow").focus()})});return $(".libelle",c).html(a).toggleClass("new",!!b),c}},j={show:function(){$("#notifications, #notifNumber").toggle(!!j.list.length),$("#notifNumber").text(j.list.length);for(var a in j.list){var b=$("#tempNotif").clone().removeAttr("id").attr("bookid",j.list[a]._id.book).appendTo("#notifs").on("click",j.click);$("#notifName",b).html(j.list[a].from),$("#notifTitle",b).html(j.list[a].title)}},click:function(){var b=this;_.remove(j.list,function(a){return a._id.book===$(b).attr("bookid")}),$("#notifs").toggle(function(){$(b).remove()}),$("#notifications, #notifNumber").toggle(!!j.list.length),$("#notifNumber").text(j.list.length),p.toggle(1,1),a.emit("readNotif",$(b).attr("bookid"))}},k={books:function(){event.preventDefault();var b=$(this).formToJSON();return d.remove(),g.destroy(),e.active.call("#recherche"),$("[name=filtre]").val("").data("prec",""),a.emit("searchBooks",{q:b.searchby+b.searchinput,langRestrict:b.langage}),n.close(),$("#navbar").addClass("inactive"),p.animToggle(!0),!1},recommand:function(){g.destroy(),e.active.call("#recherche"),$("#navbar").addClass("inactive"),p.animToggle(!0),n.close(function(){p.toggle(1,1),a.emit("recommanded")})},associated:function(b){g.destroy(),e.active.call("#recherche"),$("#navbar").addClass("inactive"),p.animToggle(!0),n.close(function(){p.toggle(1,1),a.emit("associated",b)})},end:function(a){$("#navbar").removeClass("inactive"),p.animToggle(!1),p.toggle(),console.debug("Search.end",(new Date).toLocaleString(),a,g.cells.length)}},l=function(){return c.destroy(),g.destroy(),a.close(),window.location.assign("/logout")},m=function(){var a;switch(this.setCustomValidity(""),this.name){case"searchinput":a=this.value.length<3;break;case"filtre":a=!!this.value.length&&this.value.length<3;break;case"name":a=this.value.length<4;break;case"pwd":a=this.value.length<4||this.value.length>12;break;case"newPwd":a=this.value.length<4||this.value.length>12;break;case"confirmPwd":a=this.value!==$("[name=newPwd]").val();break;case"recommand":a=this.value.toLowerCase()===c.id}a&&this.setCustomValidity($(this).attr("error"))},n={open:function(){var a=$.Deferred(),b=$(this).attr("window")||$(this);return"#profileWindow"===b&&(c.initProfileValues(),$(".changePwd input").attr("required")&&n.togglePwd()),$(".errMsg").hide(),p.toggle(1).always(function(){$(b).css("top",$(window).scrollTop()+10).fadeIn(),$(document).keyup(function(){27===event.keyCode&&n.close()}),$("[autofocus]",b).focus(),a.resolve()}),a.promise()},close:function(a){var b=$(this).closest(".window").length?$(this).closest(".window"):$(".window");$("#waiting").removeClass("over"),$(document).unbind("keyup"),$("[note]").each(e.blur),$("form",b).trigger("reset"),b.fadeOut().promise().then(function(){$.isFunction(a)?a.call():p.toggle()})},confirm:function(a,b){var c=$.Deferred();return $("#waiting").addClass("over"),$("#confirmWindow .windowheader span").text(function(){return $(this).attr(a)}),$("#confirmWindow #confirm").html(b),$("button","#confirmWindow").unbind("click").on("click",n.close),$(".valid","#confirmWindow").on("click",function(){c.resolve()}),$(".cancel","#confirmWindow").toggle("warning"===a).on("click",function(){c.reject()}),p.toggle(1).always(function(){$("#confirmWindow").css({top:"25%",left:"25%"}).fadeIn(),$(document).keyup(function(){27===event.keyCode&&n.close()})}),c.promise()},togglePwd:function(){$(".changePwd").slideToggle(function(){$("[type=password]",this).attr("required",$(this).is(":visible"))})}},o={data:{},action:function(){var b,e=o.data.book.id,f=c.bookIndex(e),i=$(this).attr("actclick");-1!==f&&(b=c.books[f]),this.add=function(){a.emit("addDetail"),$("[actclick=add], [actclick=update], #upload, .inCollection").toggle();var b=g.one(e);if($("#collection").hasClass("active")&&!b){var f=c.books.length%d.nbCols,i=$(".bookcell","[colid="+c.books.length%d.nbCols+"]").length;b=_.extend({col:f,row:i},new h(o.data.book)),g.add(b),g.reorganize()}b&&b.cell&&$("button",b.cell).fadeToggle(),c.addBook(o.data.book)},this.associated=function(){k.associated(e)},this.update=function(){var d=!1,f={id:e},g=_.map($("#userTags > div").toArray(),function(a){return $(".libelle",a).html()});$("#userNote").val()&&$("#userNote").val()!==b.note&&(d=!0,f.userNote=$("#userNote").val()),$("textarea","#userComment").val()&&$("textarea","#userComment").val()!==b.comment&&(d=!0,f.comment=$("textarea","#userComment").val()),b.tags&&g===b.tags||(d="tags",f.tags=g),$("#detailCover").attr("maincolor")&&b.base64!==$("#detailCover").prop("src")&&(d=!0,f.alternative=$("#detailCover").prop("src"),f.maincolor=$("#detailCover").attr("maincolor"),$("img:first",o.data.cell).prop("src",f.alternative)),d&&(f.userDate=(new Date).toJSON(),c.updateBook(f),c.updateTags(),$("#tags").toggle(!$.isEmptyObject(c.tags)&&$("#collection").hasClass("active")),a.emit("updateBook",f)),n.close()},this.preview=function(){$("[name=previewid]").val(e),$("#waiting").addClass("over"),n.open.call("#previewWindow").then(function(a){$("#preview").submit()})},this.google=function(){window.open($(this).attr("link"))},this.recommand=function(){$("#waiting").addClass("over"),n.open.call("#recommandWindow")},this.close=function(){$(this).closest(".window").fadeOut().promise().then(function(){$("#waiting").removeClass("over")})},this[i].call(this)},overNote:function(){for(var a=$("[note]").toArray(),b=$("#userNote").val(),c=0;c<a.length;c++)b>c?$(a[c]).prop("src",e.path+$(a[c]).attr("select")):$(a[c]).prop("src",e.path+$(a[c]).attr("blur"))},enterNote:function(){var a=$("#userNote").val()||0,b=$(this).attr("note"),c=$("[note]").toArray();if(a!==b)for(var d=0;d<Math.max(a,b);d++)d<Math.min(a,b)?$(c[d]).prop("src",e.path+$(c[d]).attr("select")):a>b?$(c[d]).prop("src",e.path+$(c[d]).attr("hoverminus")):$(c[d]).prop("src",e.path+$(c[d]).attr("hoverplus"))},clickNote:function(){$("#userNote").val($("#userNote").val()===$(this).attr("note")&&"1"===$("#userNote").val()?"0":$(this).attr("note")),o.overNote()},linkSearch:function(){$(this).attr("searchby")&&$(this).text()&&($("[type=search]","#formSearch").val($(this).text()),$("[name=searchby]","#formSearch")[$(this).attr("searchby")].checked=!0,$("#formSearch").submit())},getMainColor:function(a){var c=b.getColor(a),d="#"+((1<<24)+(c[0]<<16)+(c[1]<<8)+c[2]).toString(16).substr(1);return{rgb:c,hex:d}},uploadCover:function(){var a=this.files;if(a[0]){if(!a[0].type.match(/image.*/)||a[0].size>1e6)return alert("Veuillez sélectionner un fichier de type 'image' inférieure à 1MB."),!1;var b=new FileReader;b.onload=function(a){return function(b){a.on("load",function(){var a=o.getMainColor(this);$(this).attr("maincolor",a.hex).addClass("new"),$("#detailContent").css("background","radial-gradient(whitesmoke 40%, "+a.hex+")")}),a.prop("src",b.target.result)}}($("#detailCover")),b.readAsDataURL(this.files[0])}},recommand:function(){event.preventDefault();var b=$(this).formToJSON();b.book=o.data.book.id,b.title=o.data.book.title,a.emit("sendNotif",b),$("img","#recommandWindow").trigger("click")},show:function(a){var b=o.data.book;$("#upload","#detailWindow").toggle(!b.base64&&!b.cover&&!!a),$("[type=file]","#detailWindow").val(""),$("#comments","#detailWindow").children().remove(),$("#detailContent","#detailWindow").css("background","whitesmoke"),$("#userNote","#detailWindow").val(b.note),$(".new","#detailWindow").removeClass("new"),o.overNote(),$("#detailCover","#detailWindow").unbind("load"),$(".inCollection").toggle(!!a),b.mainColor?$("#detailContent","#detailWindow").css("background","radial-gradient(whitesmoke 40%, "+b.mainColor+")"):$("#detailCover","#detailWindow").on("load",function(){(b.alternative||b.base64)&&(b.mainColor=o.getMainColor(this).hex,$("#detailContent","#detailWindow").css("background","radial-gradient(whitesmoke 40%, "+b.mainColor+")"))}),$("#detailCover","#detailWindow").prop("src",b.alternative||b.base64||b.cover||e.path+"iconmonstr-book-4-icon-grey.png"),$(".direct","#detailWindow").text(""),$("#userTags > div","#detailWindow").remove(),$(".windowheader span","#detailWindow").text(b.title),$("[actclick=add]","#detailWindow").toggle(!a),$("[actclick=update], [actclick=recommand]","#detailWindow").toggle(!!a),$("[actclick=preview]","#detailWindow").toggle(!!b.access&&"NONE"!==b.access),$("[actclick=google]","#detailWindow").attr("link",b.link).toggle(!!b.link),$(".comments","#detailWindow").toggle(!!b.comments&&!!b.comments.length),n.open.call("#detailWindow");for(var c in b){var d=b[c];if($("#"+c).closest(".volumeInfo").toggle(!!d),"authors"===c&&b[c].length){var f=[];for(var g in b[c])f.push($("<span>").addClass("link").attr("searchby",3).text(b[c][g]));$("#authors").append(f)}else if("tags"===c&&b[c].length){for(var h=b[c],j=[],k=0,l=h.length;l>k;k++)j.push(i["new"](h[k]));$("#userTags").append(j)}else if("userNote"!==c)if("comments"===c&&b[c].length){var m=[];for(var p in b[c]){var q=$("#tempComment").clone().removeAttr("id");$("#commentAuthor",q).text(b[c][p].name),$("#commentDate",q).text(b[c][p].date.formatDate()),$("#commentNote",q).text(b[c][p].note),$("#commentComment",q).text(b[c][p].comment),m.push(q)}$("span#comments").append(m)}else $("#"+c).hasClass("date")&&(d=d.formatDate()),$.isArray(d)&&(d=d.join(", ")),$("#"+c,"#detailWindow").html(d);else o.clickNote.call($("[note="+b[c]+"]"))}$(".link").unbind("click").on("click",o.linkSearch)}},p={toggle:function(a,b){var c=$.Deferred();return $(".window").is(":visible")?c.reject():($(".description").remove(),a?(b?$("img","#waiting").show():$("img","#waiting").hide(),$("html").addClass("overflown"),$("#waiting").fadeIn().promise().then(function(){c.resolve()})):$("#waiting").fadeOut().promise().then(function(){$("html").removeClass("overflown"),$("#waiting").removeClass("over"),c.resolve()})),c.promise()},animToggle:function(a){a?$("#waitingAnim").fadeIn():$("#waitingAnim").fadeOut()}},q=function(){var b=$(this).prop("id");n.confirm("warning","Cette opération va importer/exporter vos EBooks depuis/vers votre bibliothèque Google.<BR>Etes vous sur de vouloir continuer?").then(function(){return"exportNow"===b?a.emit("exportNow"):(g.destroy(),e.active.call("#collection"),$("#navbar").addClass("inactive"),p.animToggle(!0),void n.close(function(){p.toggle(1,1),a.emit("importNow")}))})},r=function(){event.preventDefault();$(this).formToJSON();a.emit("newbook",$(this).formToJSON()),n.close()};$.fn.formToJSON=function(){if(!this.is("form"))return!1;var a={};return _.forEach(this.serializeArray(),function(b){a[b.name]=b.value}),a},String.prototype.formatDate=function(){var a=this.substr(0,10).split("-");return 3===a.length&&(a=(1===a[2].length?"0":"")+a[2]+"/"+(1===a[1].length?"0":"")+a[1]+"/"+a[0]),a},a.on("connect",function(){console.debug("socket.connect",(new Date).toLocaleString()),a.emit("isConnected")}),a.io.on("reconnect",function(){console.debug("socket.reconnect",a.connected,(new Date).toLocaleString()),a.io.reconnect()}),a.on("disconnect",function(){console.debug("socket.disconnect",(new Date).toLocaleString()),c.destroy(),n.close(),p.toggle(1,1),$(".deroulant").hide(),g.destroy()}),a.on("error",function(a){console.error(a)}),a.on("user",function(a){f.show(),c.initialize(a)}),a.on("collection",function(a){c.books=a.books,console.debug("User.books",(new Date).toLocaleString(),c.books.length),j.list=a.notifs,j.show(),$("#collection").trigger("click"),console.debug("socket.collection",(new Date).toLocaleString())}),a.on("books",g.show),a.on("endRequest",k.end),a.on("returnAdd",c.addBook),a.on("returnDetail",g.returned),a.on("logout",l),a.on("updateOk",c.retUpdate),a.on("error",function(a){console.warn(a)}),a.on("returnNotif",function(a){o.data={book:a},o.show(-1!==c.bookIndex(a.id))}),$(document).on("scroll",g.loadCovers),$("[type=text], [type=search], [type=password], [type=email]").on("input propertychange",m),$("#logout").on("click",l),$("#formSearch").submit(k.books),$("#formProfil").submit(c.update),$("#formRecommand").submit(o.recommand),$("#formNew").submit(r),$("#formTag").submit(i.add),$("#changePwd").on("click",n.togglePwd),$("#delete").on("click",c["delete"]),$("#tris").on("click",f.toggleSort),$("#notifications").on("click",f.toggleNotif),$("#sort > div").on("click",g.sort),$("[actclick]").hover(e.hover,e.blur).on("click",o.action),$(".closeWindow").on("click",n.close),$("#footer").on("click",function(){$("body").animate({scrollTop:0})}),$("#upload").on("click",function(){$("[type=file]","#uploadHidden").trigger("click")}),$("[type=file]","#uploadHidden").change(o.uploadCover),$("#userNote > img").hover(o.enterNote,o.overNote).on("click",o.clickNote),$(".navbar > div, .closeWindow, #footer, [by], .imgAction img, #cloud img, #contactsWindow img").not(".picture, [note]").hover(e.hover,e.blur),$("[blur]").each(e.blur),$("img").attr("draggable",!1),$("#navbar").removeClass("notdisplayed"),$("#collection").on("click",c.collection),$("#tags, #cloud > img").on("click",i.show),$("#recherche, #profil, #contact, #newbook").on("click",n.open),$("[name=filtre]").on("search",g.filter),$("#formFilter").on("submit",function(){event.preventDefault()}),$(".togglenavbar").on("click",f.toggle),$("[url]").on("click",f.link),$("[mail]").on("click",f.mail),$("#recommand4u").on("click",k.recommand),$("#importNow, #exportNow").on("click",q),$("html").on("click",function(a){-1===$.inArray($(a.target).closest(".action").prop("id"),["notifications","tris"])&&$(".deroulant").fadeOut()}),$(window).resize(function(){d.nbCols!==~~($(window).innerWidth()/256)&&(n.close(),$(".deroulant").hide(),d.nbCols=~~($(window).innerWidth()/256)),g.reorganize()})}):alert(document.getElementsByTagName("body")[0].getAttribute("error"));
