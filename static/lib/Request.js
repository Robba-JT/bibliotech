"use strict";var req=function(){var a=function b(a){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(this instanceof b))return new b(a,c,d);this.method=_.toUpper(c),this.headers={};for(var e in d)_.has(d,e)&&(this.headers[_.toUpper(e)]=d[e]);return this.url=encodeURI(_.startsWith(a,"http")||_.startsWith(a,"/")?a:"/"+a),this.req=new XMLHttpRequest,this};return a.prototype.setHeaders=function(){for(var a in this.headers)_.has(this.headers,a)&&this.req.setRequestHeader(a,this.headers[a]);return this},a.prototype.jsonToQueryString=function(a){var b="",c=_.keys(a),d=c.length-1;return _.isPlainObject(a)&&(b+="?",_.forEach(c,function(c,e){b+=c+"="+a[c],d>e&&(b+="&")})),this.url+=encodeURI(b),this},Reflect.defineProperty(a.prototype,"response",{get:function(){if(!_.has([200,204],this.req.status))return null;try{return JSON.parse(this.req.response)}catch(a){return this.req.responseText}}}),Reflect.defineProperty(a.prototype,"error",{get:function(){return 200!==this.req.status&&204!==this.req.status&&this.req.responseText}}),a.prototype.send=function(a){var b=this;return this.url?new Promise(function(c,d){try{"GET"===b.method?b.jsonToQueryString(a):!_.has(b.headers,"CONTENT-TYPE")&&_.isPlainObject(a)?(b.headers={"CONTENT-TYPE":"application/json;charset=UTF-8"},b.data=JSON.stringify(a)):b.data=a,b.req.open(b.method,b.url,!0),b.setHeaders(),b.req.addEventListener("error",d),b.req.addEventListener("readystatechange",function(){if(b.req.readyState===XMLHttpRequest.DONE)if(403===b.req.status)em.emit("logout");else if(_.includes([200,204],b.req.status))try{c(JSON.parse(b.req.response))}catch(a){c(b.req.responseText)}else try{d(JSON.parse(b.req.response))}catch(a){d(b.req.responseText)}}),b.req.send(b.data)}catch(e){d(e)}}):Promise.reject(new Error(["Request invalid argument","URL parameter is missing."]))},a}();